{% extends "base.html" %}

{% block title %}Settings - AI-Assisted CRM{% endblock %}
{% block page_title %}Settings{% endblock %}

{% block extra_js %}
<script>
// Tab switching - Global function
window.showTab = function(tabName, clickedButton) {
    console.log('showTab called with:', tabName);

    // Hide all tab contents
    const tabContents = document.querySelectorAll('.settings-tab-content');
    tabContents.forEach(tab => tab.classList.add('hidden'));

    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.settings-tab');
    tabs.forEach(tab => tab.classList.remove('active'));

    // Show selected tab content
    const selectedContent = document.getElementById(tabName + '-tab');
    if (selectedContent) {
        selectedContent.classList.remove('hidden');
        console.log('Showing tab:', tabName);
    } else {
        console.error('Tab content not found:', tabName + '-tab');
    }

    // Add active class to clicked tab
    if (clickedButton) {
        clickedButton.classList.add('active');
    }

    // Load integration status when switching to integrations tab
    if (tabName === 'integrations') {
        checkMS365Status();
    }
};

// Check authentication before loading page
document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('access_token');
    const userData = localStorage.getItem('user_data');
    if (!token || !userData) {
        window.location.href = '/login';
        return;
    }
    fetch('/api/v1/auth/me', {
        method: 'GET',
        headers: {'Authorization': 'Bearer ' + token}
    }).then(response => {
        if (response.status === 401 || response.status === 403) {
            localStorage.removeItem('access_token');
            localStorage.removeItem('user_data');
            window.location.href = '/login';
        } else {
            // Load Microsoft 365 integration status
            checkMS365Status();

            // Check for OAuth callback parameters
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('integration') === 'ms365') {
                if (urlParams.get('success') === 'true') {
                    showMS365Success('Microsoft 365 connected successfully!');
                    setTimeout(() => checkMS365Status(), 1000);
                } else if (urlParams.get('error')) {
                    showMS365Error('Connection failed: ' + urlParams.get('error'));
                }
                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }
    }).catch(error => {
        console.error('Auth verification failed:', error);
        localStorage.removeItem('access_token');
        localStorage.removeItem('user_data');
        window.location.href = '/login';
    });
});

// Microsoft 365 Integration Functions
async function checkMS365Status() {
    const token = localStorage.getItem('access_token');
    const statusDiv = document.getElementById('ms365-status');
    const controlsDiv = document.getElementById('ms365-controls');
    const connectBtn = document.getElementById('ms365-connect-btn');
    const disconnectBtn = document.getElementById('ms365-disconnect-btn');
    const testBtn = document.getElementById('ms365-test-btn');
    const toolsDiv = document.getElementById('ms365-tools');
    const errorDiv = document.getElementById('ms365-error');

    try {
        const response = await fetch('/api/v1/integrations/ms365/status', {
            headers: {'Authorization': 'Bearer ' + token}
        });

        const data = await response.json();
        controlsDiv.style.display = 'block';

        if (data.connected) {
            // Connected state
            statusDiv.innerHTML = `
                <div class="status-badge status-connected">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Connected</span>
                    ${data.connected_at ? `<span class="status-date">since ${new Date(data.connected_at).toLocaleDateString()}</span>` : ''}
                </div>
            `;

            connectBtn.style.display = 'none';
            disconnectBtn.style.display = 'block';
            testBtn.style.display = 'block';
            toolsDiv.style.display = 'block';
            errorDiv.style.display = 'none';

        } else {
            // Disconnected state
            statusDiv.innerHTML = `
                <div class="status-badge status-disconnected">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    <span>Not connected</span>
                </div>
            `;

            connectBtn.style.display = 'block';
            disconnectBtn.style.display = 'none';
            testBtn.style.display = 'none';
            toolsDiv.style.display = 'none';

            if (data.error) {
                showMS365Error(data.error);
            } else {
                errorDiv.style.display = 'none';
            }
        }

    } catch (error) {
        console.error('Failed to check MS365 status:', error);
        statusDiv.innerHTML = `
            <div class="status-badge status-error">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>Error checking status</span>
            </div>
        `;
        controlsDiv.style.display = 'none';
    }
}

async function connectMS365() {
    const token = localStorage.getItem('access_token');
    const connectBtn = document.getElementById('ms365-connect-btn');

    connectBtn.disabled = true;
    connectBtn.innerHTML = '<span class="loading-spinner-inline mr-2"></span>Connecting...';

    try {
        const response = await fetch('/api/v1/integrations/ms365/auth', {
            headers: {'Authorization': 'Bearer ' + token}
        });

        const data = await response.json();

        if (data.auth_url) {
            window.location.href = data.auth_url;
        } else {
            throw new Error('No authorization URL received');
        }

    } catch (error) {
        console.error('Failed to initiate MS365 connection:', error);
        showMS365Error('Failed to start connection process: ' + error.message);

        connectBtn.disabled = false;
        connectBtn.innerHTML = `
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            Connect Microsoft 365
        `;
    }
}

async function disconnectMS365() {
    const token = localStorage.getItem('access_token');
    const disconnectBtn = document.getElementById('ms365-disconnect-btn');

    if (!confirm('Are you sure you want to disconnect Microsoft 365? You will lose access to email, calendar, and file operations.')) {
        return;
    }

    disconnectBtn.disabled = true;
    disconnectBtn.innerHTML = '<span class="loading-spinner-inline mr-2"></span>Disconnecting...';

    try {
        const response = await fetch('/api/v1/integrations/ms365', {
            method: 'DELETE',
            headers: {'Authorization': 'Bearer ' + token}
        });

        const data = await response.json();

        if (data.success) {
            showMS365Success('Microsoft 365 disconnected successfully');
            setTimeout(() => checkMS365Status(), 1000);
        } else {
            throw new Error(data.message || 'Disconnect failed');
        }

    } catch (error) {
        console.error('Failed to disconnect MS365:', error);
        showMS365Error('Failed to disconnect: ' + error.message);

        disconnectBtn.disabled = false;
        disconnectBtn.innerHTML = `
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
            Disconnect
        `;
    }
}

async function testMS365Connection() {
    const token = localStorage.getItem('access_token');
    const testBtn = document.getElementById('ms365-test-btn');

    testBtn.disabled = true;
    testBtn.innerHTML = '<span class="loading-spinner-inline mr-2"></span>Testing...';

    try {
        const response = await fetch('/api/v1/integrations/ms365/test', {
            method: 'POST',
            headers: {'Authorization': 'Bearer ' + token}
        });

        const data = await response.json();

        if (data.success) {
            showMS365Success('Connection test successful! Found ' + (data.test_result?.folders_found || 0) + ' email folders.');
        } else {
            throw new Error(data.error || 'Test failed');
        }

    } catch (error) {
        console.error('MS365 connection test failed:', error);
        showMS365Error('Connection test failed: ' + error.message);
    } finally {
        testBtn.disabled = false;
        testBtn.innerHTML = `
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            Test Connection
        `;
    }
}

function showMS365Success(message) {
    const errorDiv = document.getElementById('ms365-error');
    errorDiv.className = 'modern-alert modern-alert-success';
    errorDiv.style.display = 'block';
    errorDiv.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        <div>
            <h3 class="font-semibold">Success!</h3>
            <p class="text-sm opacity-90">${message}</p>
        </div>
    `;

    setTimeout(() => {
        errorDiv.style.display = 'none';
    }, 5000);
}

function showMS365Error(message) {
    const errorDiv = document.getElementById('ms365-error');
    errorDiv.className = 'modern-alert modern-alert-error';
    errorDiv.style.display = 'block';
    errorDiv.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
        <div>
            <h3 class="font-semibold">Connection Error</h3>
            <p class="text-sm opacity-90">${message}</p>
        </div>
    `;
}
</script>
{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div class="space-y-2">
        <p class="text-lg opacity-80" style="color: var(--foreground-secondary)">
            Manage your account and preferences ‚öôÔ∏è
        </p>
    </div>

    <!-- Modern Tab Navigation -->
    <div class="settings-tabs-modern">
        <button class="settings-tab active" onclick="showTab('profile', this)">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            Profile
        </button>
        <button class="settings-tab" onclick="showTab('integrations', this)">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            Integrations
        </button>
        <button class="settings-tab" onclick="showTab('ai', this)">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
            </svg>
            AI Assistant
        </button>
        <button class="settings-tab" onclick="showTab('security', this)">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
            </svg>
            Security
        </button>
    </div>

    <!-- Tab Content -->
    <div>
        <!-- Profile Tab -->
        <div id="profile-tab" class="settings-tab-content">
            <div class="settings-card-modern">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="icon-badge-modern">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gradient">Profile Information</h2>
                </div>

                <p class="mb-8 opacity-80" style="color: var(--foreground-secondary)">
                    Update your personal information and preferences
                </p>

                <div class="space-y-6">
                    <div class="form-group-modern">
                        <label class="form-label-modern">Full Name</label>
                        <input type="text" class="form-input-modern" placeholder="Your name" value="">
                    </div>

                    <div class="form-group-modern">
                        <label class="form-label-modern">Email Address</label>
                        <input type="email" class="form-input-modern" placeholder="your@email.com" value="" disabled>
                        <p class="text-xs mt-2 opacity-60" style="color: var(--foreground-secondary)">Email cannot be changed</p>
                    </div>

                    <div class="form-group-modern">
                        <label class="form-label-modern">Company</label>
                        <input type="text" class="form-input-modern" placeholder="Your company name" value="">
                    </div>

                    <div class="form-group-modern">
                        <label class="form-label-modern">Role</label>
                        <input type="text" class="form-input-modern" placeholder="Your role" value="">
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button class="btn-modern btn-primary">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Save Changes
                        </button>
                        <button class="btn-modern btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integrations Tab -->
        <div id="integrations-tab" class="settings-tab-content hidden">
            <div class="space-y-6">
                <div>
                    <h2 class="text-2xl font-bold text-gradient mb-2">Integrations</h2>
                    <p class="opacity-80" style="color: var(--foreground-secondary)">
                        Connect external services to enhance your CRM experience
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Microsoft 365 Integration -->
                    <div class="integration-card-modern">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #0078d4, #106ebe);">
                                    <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M23.15 2.587L13.152.152a1.077 1.077 0 0 0-.304 0L2.85 2.587A.898.898 0 0 0 2 3.442v5.983c0 6.435 2.564 9.243 10.848 11.4a1.046 1.046 0 0 0 .304 0C21.436 18.665 24 15.857 24 9.425V3.442a.898.898 0 0 0-.85-.855zm-11.302 8.77a.652.652 0 0 1-.7-.676V7.365h-.78c-.433 0-.738-.152-.738-.676s.305-.676.738-.676h2.109c.433 0 .739.152.739.676s-.306.676-.739.676h-.729v3.316a.652.652 0 0 1-.7.676z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg" style="color: var(--foreground)">Microsoft 365</h3>
                                    <p class="text-sm opacity-70" style="color: var(--foreground-secondary)">Outlook, Calendar, OneDrive, Teams</p>
                                </div>
                            </div>
                        </div>

                        <p class="text-sm mb-4 opacity-80" style="color: var(--foreground-secondary)">
                            Connect your Microsoft 365 account to access emails, calendar, OneDrive files, and Teams collaboration
                        </p>

                        <!-- Integration Status -->
                        <div id="ms365-status" class="mb-4">
                            <div class="status-badge status-loading">
                                <span class="loading-spinner-inline"></span>
                                <span>Checking connection...</span>
                            </div>
                        </div>

                        <!-- Connection Controls -->
                        <div id="ms365-controls" class="space-y-3" style="display: none;">
                            <button id="ms365-connect-btn" class="btn-modern btn-primary w-full" onclick="connectMS365()" style="display: none;">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                Connect Microsoft 365
                            </button>

                            <div class="flex gap-3">
                                <button id="ms365-disconnect-btn" class="btn-modern btn-secondary flex-1" onclick="disconnectMS365()" style="display: none;">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                    Disconnect
                                </button>

                                <button id="ms365-test-btn" class="btn-modern btn-secondary flex-1" onclick="testMS365Connection()" style="display: none;">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    Test
                                </button>
                            </div>
                        </div>

                        <!-- Available Tools -->
                        <div id="ms365-tools" class="mt-4 pt-4 border-t" style="border-color: rgba(255, 255, 255, 0.1); display: none;">
                            <p class="text-sm font-semibold mb-3 opacity-80" style="color: var(--foreground)">Available Tools</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="tool-badge">üìß Email</span>
                                <span class="tool-badge">üìÖ Calendar</span>
                                <span class="tool-badge">üìÅ OneDrive</span>
                                <span class="tool-badge">üîó SharePoint</span>
                                <span class="tool-badge">üë• Teams</span>
                                <span class="tool-badge">üìÑ Documents</span>
                            </div>
                            <p class="text-xs mt-3 opacity-60" style="color: var(--foreground-secondary)">
                                üí¨ Try: "Send email to john@example.com", "What's on my calendar?", "List my OneDrive files"
                            </p>
                        </div>

                        <!-- Error Display -->
                        <div id="ms365-error" class="modern-alert mt-4" style="display: none;"></div>
                    </div>

                    <!-- Google Workspace Integration (Placeholder) -->
                    <div class="integration-card-modern integration-disabled">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #4285f4, #34a853);">
                                    <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg" style="color: var(--foreground)">Google Workspace</h3>
                                    <p class="text-sm opacity-70" style="color: var(--foreground-secondary)">Gmail, Calendar, Drive</p>
                                </div>
                            </div>
                            <span class="coming-soon-badge">Coming Soon</span>
                        </div>

                        <p class="text-sm opacity-60" style="color: var(--foreground-secondary)">
                            Connect Google Workspace for Gmail, Calendar, and Drive integration
                        </p>
                    </div>

                    <!-- Slack Integration (Placeholder) -->
                    <div class="integration-card-modern integration-disabled">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #611f69, #4a154b);">
                                    <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg" style="color: var(--foreground)">Slack</h3>
                                    <p class="text-sm opacity-70" style="color: var(--foreground-secondary)">Team Communication</p>
                                </div>
                            </div>
                            <span class="coming-soon-badge">Coming Soon</span>
                        </div>

                        <p class="text-sm opacity-60" style="color: var(--foreground-secondary)">
                            Integrate with Slack for team communication and notifications
                        </p>
                    </div>

                    <!-- More Integrations (Placeholder) -->
                    <div class="integration-card-modern integration-disabled">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg" style="color: var(--foreground)">More Integrations</h3>
                                    <p class="text-sm opacity-70" style="color: var(--foreground-secondary)">Additional Services</p>
                                </div>
                            </div>
                            <span class="coming-soon-badge">Coming Soon</span>
                        </div>

                        <p class="text-sm opacity-60" style="color: var(--foreground-secondary)">
                            Additional integrations will be available soon
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Assistant Tab -->
        <div id="ai-tab" class="settings-tab-content hidden">
            <div class="settings-card-modern">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="icon-badge-modern">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gradient">AI Assistant Settings</h2>
                </div>

                <p class="mb-8 opacity-80" style="color: var(--foreground-secondary)">
                    Configure AI preferences and provider settings
                </p>

                <!-- AI Provider Selection -->
                <div class="space-y-6">
                    <div class="form-group-modern">
                        <label class="form-label-modern">AI Provider</label>
                        <select
                            id="ai-provider-settings"
                            class="form-input-modern"
                            hx-post="/api/v1/chat/provider"
                            hx-trigger="change"
                            hx-include="this"
                            hx-swap="none">
                            <option value="claude">Claude (Anthropic) - Recommended</option>
                            <option value="openai">GPT (OpenAI)</option>
                            <option value="gemini">Gemini (Google)</option>
                        </select>
                        <p class="text-xs mt-2 opacity-60" style="color: var(--foreground-secondary)">
                            Choose your preferred AI model for the assistant
                        </p>
                    </div>

                    <div class="p-4 rounded-xl" style="background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.1);">
                        <div class="flex items-start gap-3">
                            <svg class="w-5 h-5 mt-0.5 flex-shrink-0" style="color: var(--primary);" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                            <div class="text-sm">
                                <p class="font-semibold mb-1" style="color: var(--foreground)">Claude is recommended</p>
                                <p class="opacity-80" style="color: var(--foreground-secondary)">
                                    Claude provides the best support for MCP integrations and natural conversation flow.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button class="btn-modern btn-secondary">Advanced AI Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Tab -->
        <div id="security-tab" class="settings-tab-content hidden">
            <div class="settings-card-modern">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="icon-badge-modern">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gradient">Security Settings</h2>
                </div>

                <p class="mb-8 opacity-80" style="color: var(--foreground-secondary)">
                    Manage your password and security preferences
                </p>

                <div class="space-y-8">
                    <!-- Change Password Section -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4" style="color: var(--foreground)">Change Password</h3>
                        <div class="space-y-4">
                            <div class="form-group-modern">
                                <label class="form-label-modern">Current Password</label>
                                <input type="password" class="form-input-modern" placeholder="Enter current password">
                            </div>

                            <div class="form-group-modern">
                                <label class="form-label-modern">New Password</label>
                                <input type="password" class="form-input-modern" placeholder="Enter new password">
                            </div>

                            <div class="form-group-modern">
                                <label class="form-label-modern">Confirm New Password</label>
                                <input type="password" class="form-input-modern" placeholder="Confirm new password">
                            </div>

                            <button class="btn-modern btn-primary">Update Password</button>
                        </div>
                    </div>

                    <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 2rem;"></div>

                    <!-- Two-Factor Authentication -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2" style="color: var(--foreground)">Two-Factor Authentication</h3>
                        <p class="text-sm mb-4 opacity-70" style="color: var(--foreground-secondary)">
                            Add an extra layer of security to your account
                        </p>
                        <button class="btn-modern btn-secondary">Enable 2FA</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Settings-specific styles */
.settings-tabs-modern {
    display: flex;
    gap: 8px;
    padding: 8px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    backdrop-filter: blur(10px);
    overflow-x: auto;
}

.settings-tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background: transparent;
    border: none;
    border-radius: 12px;
    color: var(--foreground-secondary);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.settings-tab:hover {
    background: rgba(255, 255, 255, 0.08);
    color: var(--foreground);
}

.settings-tab.active {
    background: linear-gradient(135deg, var(--primary), var(--accent));
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.settings-tab-content {
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

.settings-card-modern {
    background: linear-gradient(135deg,
        rgba(255, 255, 255, 0.15) 0%,
        rgba(255, 255, 255, 0.05) 100%),
        var(--card);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    padding: 32px;
    box-shadow:
        0 10px 40px rgba(0, 0, 0, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.integration-card-modern {
    background: linear-gradient(135deg,
        rgba(255, 255, 255, 0.15) 0%,
        rgba(255, 255, 255, 0.05) 100%),
        var(--card);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 24px;
    transition: all 0.3s ease;
    box-shadow:
        0 10px 40px rgba(0, 0, 0, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.integration-card-modern:hover {
    transform: translateY(-4px);
    box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
}

.integration-card-modern.integration-disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.integration-card-modern.integration-disabled:hover {
    transform: none;
}

.integration-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 12px;
    font-size: 0.875rem;
    font-weight: 500;
}

.status-connected {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.2);
}

.status-disconnected {
    background: rgba(156, 163, 175, 0.1);
    color: #9ca3af;
    border: 1px solid rgba(156, 163, 175, 0.2);
}

.status-error {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.2);
}

.status-loading {
    background: rgba(59, 130, 246, 0.1);
    color: var(--primary);
    border: 1px solid rgba(59, 130, 246, 0.2);
}

.status-date {
    opacity: 0.7;
    font-size: 0.75rem;
}

.coming-soon-badge {
    padding: 4px 12px;
    background: rgba(234, 179, 8, 0.1);
    color: #eab308;
    border: 1px solid rgba(234, 179, 8, 0.2);
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
}

.tool-badge {
    padding: 6px 12px;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--foreground);
}

.modern-alert {
    display: flex;
    align-items: start;
    gap: 12px;
    padding: 16px;
    border-radius: 12px;
}

.modern-alert-success {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.2);
    color: #22c55e;
}

.modern-alert-error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    color: #ef4444;
}

[data-theme="dark"] .settings-card-modern,
[data-theme="dark"] .integration-card-modern {
    background: linear-gradient(135deg,
        rgba(20, 20, 20, 0.8) 0%,
        rgba(30, 30, 30, 0.6) 100%),
        var(--card);
}

[data-theme="dark"] .settings-tabs-modern {
    background: rgba(20, 20, 20, 0.5);
    border-color: rgba(255, 255, 255, 0.1);
}
</style>
{% endblock %}
